<!DOCTYPE html>
<html lang="en">
<head>
    <script type="text/javascript" src="d3.min.js"></script>
    <meta charset="UTF-8">
    <title>My Life in Weeks</title>

    <style>
        body {
            font-family: "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif;
        }

        h1 {
            font-weight: 600;
            text-align: center;
        }

        article {
            margin-left: auto;
            margin-right: auto;
            width: 800px;
        }

        svg{

        }

        div.tooltip {
            position: absolute;
            display: inline-block;
            text-align: center;
            width: auto;
            height: auto;
            padding: 0px;
            background: navy;
            border: 0px;
            border-radius: 5px;
            pointer-events: none;
            font-size: small;
            font-weight: bolder;
            color: white;

        }
    </style>
</head>
<body>
<article>
    <h1>My Life in Weeks</h1>
    <script>

        //http://stackoverflow.com/questions/17246002/construct-an-array-of-dates-between-start-and-end-dates-d3-js
        var lifeData = [
            { start: new Date(1987,4,5), end: new Date(1987,4,12), text:"Week1", color:"pink"},
            { start: new Date(1987,4,13), end: new Date(1987,4,20), text:"Week2", color:"brown"},
            { start: new Date(1987,4,21), end: new Date(1987,4,28), text:"Week3", color:"yellow"},
            { start: new Date(1987,4,29), end: new Date(1987,5,5), text:"Week3", color:"purple"},
            { start: new Date(1987,6,5), end: new Date(1994,6,31), text:"Baby", color:"green"},
            { start: new Date(1994,7,1), end: new Date(1999,5,1), text:"Grundschule", color:"blue"},
            { start: new Date(1999,5,2), end: new Date(1999,6,31), text:"Nothing", color:"white"},
            { start: new Date(1999,7,1), end: new Date(2003,5,1), text:"Sekundarschule", color:"yellow"},
            { start: new Date(2003,7,1), end: new Date(2007,5,1), text:"Berufslehre", color:"orange"},
            { start: new Date(2009,11,1), end: new Date(2011,7,31), text:"Edg. Fa. Informatik", color:"red"},
            { start: new Date(2012,8,1), end: new Date(2017,2,31), text:"BSc Informatik", color:"purple"}

        ];

        var lifeDataWeeks = [];
        var weeks = [];

        lifeData.forEach(function(d) {
            //get Array with weeks for each event
            weeks = d3.timeWeeks(d.start, d.end);
            //for each week, get Data
            weeks.forEach(function (e) {
                //push weekdates + additional info in new Array[date, text, color]
                    lifeDataWeeks.push({date: e, text: d.text, color: d.color})
                })
        });

        //console.log("Weeks");
        //console.log(lifeDataWeeks);
        //console.log("Colors");
        //console.log(lifeDataColors);
        //console.log("Expanded");
        //console.log(lifeDataExpanded);
        //console.log("tmp2");
        //console.log(tmp2);


        //520x900 for data, rest for axis description etc
        var margin = {top: 20, right: 0, bottom: 20, left:30};
        var width = 550 - margin.left - margin.right,
            height = 940 - margin.top - margin.bottom;

        var div = d3.select("body").append("div")
            .attr("class", "tooltip")
            .style("opacity", 0)


        var svgArea = d3.select("body").append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        var x = d3.scaleLinear()
            .domain([0,51])
            .range([0,width]);

        var y = d3.scaleLinear()
            .domain([1,90])
            .range([0,height]);


        //date formatting: https://github.com/d3/d3-time-format/blob/master/README.md#locale_format
        var formatWeek = d3.timeFormat("%W"); //week beginning monday
        var formatYear = d3.timeFormat("%Y"); //year with 4 digits

        var rectangles = svgArea.selectAll("rect")
            .data(lifeDataWeeks)
            .enter()
            .append("rect");

        var styleRect = rectangles
            .attr("x", function(d){return x(formatWeek(d.date));})
            .attr("y", function(d){return y(formatYear(d.date)-1986);}) //format years to 1-90
            .attr("rx", 3)
            .attr("ry", 3)
            .attr("width", 9)
            .attr("height", 9)
            .attr("stroke", "black")
            .attr("stroke-width", 1)
            .style("fill", function (d){ return d.color;})
            .on("mouseover", function(d)
        {
            div.transition()
                .duration(200)
                .style("opacity", .8);
            div.html(d.text)
                .style("left", (d3.event.pageX)+10 + "px")
                .style("top", (d3.event.pageY)-10 + "px");
        })
            .on("mouseout", function(d)
            {
               div.transition()
                   .duration(200)
                   .style("opacity", 0);
            });

        /*    .style("fill", function(d)
            {
                console.log(d.color);
                if(this.x.equals(x(formatWeek(d.date)) && this.y.equals(y(formatYear(d.date))))){
                    return d.color;
                } else {
                    return white;
                }
            });

          */
        //.style("fill", "white")
            /*.style("fill", function(d){
                for(a = 0; a < lifeData.length; a++){
                    if(d >= lifeData[a].start && d <= lifeData[a].end){
                        return lifeData[a].color;
                    }
                }
            } );
            */
        var xAchse = d3.axisBottom(x)
            .ticks(10);

        var yAchse = d3.axisLeft(y)
            .ticks(30);

        svgArea.append("g")
            .attr("transform", "translate(0," + height + ")")
            .call(xAchse);

        svgArea.append("g")
            //.attr("transform", "translate("+margin.left+",0)")
            .call(yAchse);

    </script>
</article>

</body>
</html>